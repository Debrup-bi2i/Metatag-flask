<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Meta-tag Explorer</title>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>

<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='app.css')}}" />
    </head>
    <body >
    <div>
        <div class="hplogo">
            <img src="{{url_for('static', filename='hp.jpg')}}"/>
        </div>
        <div class="title"> 
            <label class="meta-tag">Meta-tag Explorer</label>
        </div>
        <div class="linebreaks"> </div>
         <img class="previous" onclick="back_prev();" style="width:35px;" src="{{url_for('static', filename='back.png')}}"/>
        <label class ="page" id="page">  </label>
        <label class="validation" id="validation"> </label>
        <div class="rectangle">
         <!--<img src="{{url_for('static', filename='rectangle1.png')}}"/> -->
        </div>
        <div class="row" >

      <div class="container">
    
    <div class="row" style="float: right;">
        <div class="col-12">
            <h2 class="mt-3">
            
          <span  
                  class="editable"
                  data-toggle="popover"
                  data-container="body"
                  data-placement="left"
                  data-title="Filter By"
                  data-content="<div class='row' style='
    background: #F6FBFD;
    opacity: 0.6;
    box-shadow: inset 0px 0px 2px rgba(0, 0, 0, 0.25);margin-top: -8px;
'> <ul>
    <li class='tit'>General</li>
     <li class='tit'>Info</li>
     <li class='tit'>Product Detail</li>
     <li class='tit'>Family Info</li>
     
    
    </ul>
    </div>
    <form>
  <div class='form-group'>
  <ul class='checkbox-grid'>
 <div class='column1'>
  <li><input type='checkbox' id='checkbox1' name='text' value='4'  /><label class='filter-label' for='text1'>BU &nbsp; </label></li>
 

  <li><input type='checkbox' id='checkbox2' name='text' value='15' /><label  class='filter-label' for='text2'>Sub_bu</label></li>
  <li><input type='checkbox' id='checkbox3' name='text' value='5' /><label  class='filter-label' for='text3'>web_section_id</label></li>
  <li><input type='checkbox' id='checkbox4' name='text' value='6' /><label  class='filter-label' for='text4'>page_content</label></li>
  </div>
<div class='column2'>
  <li><input type='checkbox' id='checkbox5' name='text' value='7' /><label  class='filter-label' for='text5'>Segment</label></li>
 
  <li><input type='checkbox' id='checkbox6' name='text' value='8' /><label  class='filter-label' for='text6'>Lifecycle</label></li>
  <li><input type='checkbox' id='checkbox7' name='text' value='9' /><label  class='filter-label' for='text7'>user_profile</label></li>
  <li><input type='checkbox' id='checkbox8' name='text' value='10' /><label  class='filter-label' for='text8'>simple_title</label></li>
</div>
<div class='column3'>
   <li><input type='checkbox' id='checkbox9' name='text' value='16'  /><label  class='filter-label' for='text1'>analytics_template_name</label></li>
  <li><input type='checkbox' id='checkbox10' name='text' value='17' /><label  class='filter-label' for='text2'>product_service_name</label></li>
  
  <li><input type='checkbox' id='checkbox11' name='text' value='18' /><label  class='filter-label' for='text3'>analytics_section</label></li>
</div>
<div class='column4'>
  <li><input type='checkbox' id='checkbox12' name='text' value='11' /><label  class='filter-label' for='text4'>hp_design_version</label></li>
  <li><input type='checkbox' id='checkbox13' name='text' value='12' /><label  class='filter-label' for='text5'>page_level</label></li>
  <li><input type='checkbox' id='checkbox14' name='text' value='13' /><label  class='filter-label' for='text6'>product_type</label></li>
  <li><input type='checkbox' id='checkbox15' name='text' value='14' /><label   class='filter-label' for='text7'>Family</label></li>
  </div>
</ul>
  <button type='button' class='btn-reset' onclick='reset_filter();' >Reset Filters</button>
  <button type='button' onclick='show_hide_column();' class='btn-filter'>Apply Filters</button>
</form>">
           <img src="{{url_for('static', filename='Filter.png')}}" onclick='state1();' style="margin-top: 70px;"/>
          </span>
            </h2>
        </div>
    </div>
</div>
        </div>
        <div class="masterUrl1">
        <label id="url" class="url">Master Url</label>
        <label id="urlvalue" class="urlvalue"></label></div>
        <div class="pageLevel">
        <label  class="plevel">Page Level</label>
        <label id="plValue" class="plValue"></label></div>
        <div class="bu">
        <label class="buTitle">BU</label>
        <label id="buValue" class="buValue"></label></div>
        <div class="webId">
        <label class="webIdTitle">WebSection Id</label>
        <label id="webValue" class="webValue"></label></div>
        <div class="profile">
        <label class="profileTitle">User Profile</label>
        <label id="profileValue" class="profileValue"></label></div>
        <div class="simple">
        <label class="simpleTitle">Simple Title</label>
        <label id="simpleValue" class="simpleValue"></label></div>
        <div class="product">
        <label class="productTitle">Product Service Name</label>
        <label id="productValue" class="productValue"></label></div>
        <div class="pcontent">
        <label class="contentTitle">Page Content</label>
        <label id="contentValue" class="contentValue"></label></div>
        <div class="segment">
        <label class="segmentTitle">Segment</label>
        <label id="segmentValue" class="segmentValue"></label></div>
        <div class="lifecycle">
        <label class="lifecycleTitle">Lifecycle</label>
         <label id="lifeValue" class="lifeValue"></label></div>
        <div class="version">
        <label class="versionTitle">HP Design Version</label>
         <label id="versionValue" class="versionValue"></label></div>
        <div class="desName">
        <label class="nameTitle">Analytics Design Name</label>
         <label id="nameValue" class="nameValue"></label></div>
        <div class="subBu">
        <label class="subButitle">Sub BU</label>
         <label id="subBuValue" class="subBuValue"></label></div>
         <div class="ptype">
        <label class="prodTitle">Product Type</label>
        <label id="prodValue" class="prodValue"></label></div>
        <div class="family">
        <label class="familyTitle">Family</label>
        <label id="famValue" class="famValue"></label></div>
        <div class="analytics">
        <label class="analyticsTitle">Analytics Section</label>
        <label id="analyticsValue" class="analyticsValue"></label></div>
        
        <div id="result" class="result">
         <img src="{{url_for('static', filename='Rectangle2.png')}}"/>
        </div>
       
        <div class="resultTitle"> 
        <lablel class="resultName">Result</label>
        </div>
       
        <div class="green"> 
        <lablel class="alligned">Completely Alligned</label>
        </div>
        <div class="red"> 
        <lablel class="notAlligned">Not alligned</label>
        </div>
        <div class="download"> 
       <img id="downloadImage" onclick="download();" src="{{url_for('static', filename='download.png')}}"/>
        </div>
        <div class ="urlIcon1">
        <img id="urlImage1" style="width:22px;" src="{{url_for('static', filename='allign.PNG')}}"/>
        <label id="totalCount1">
        </label>
        </div>
        <div class ="urlIcon">
        <img id="urlImage" src="{{url_for('static', filename='urlIcon.png')}}"/>
        <label id="totalCount">
        </label>
        <div class ="urlIcon">
        <img id="urlImage2" src="{{url_for('static', filename='error.png')}}"/>
        <label id="totalCount2">
        </label>
        <div id="resultTable" style="position: absolute;height: 325px;width: 1135px;overflow: auto;
    margin-left: -350px;
    top: -350px;">
        </div>
        </div>
        
        
         
     </div>
     <div id="content" class="container"></div>
     <script>
    filterlist = [];
     idList =[];
     prefilter =[];
     notAlligned =0;
     alligned =1;
     count =0;
     var unchecklist =[];
        function reset_filter()
        {
            
            $('input:checkbox:checked').prop('checked', false);
            filterlist = [];
            idList =[];
       }
   
    function state1(){
         $("[data-toggle='popover']").on('shown.bs.popover', function(){
  console.log(idList);
 
  for (var i in idList) {
   
    $( "#"+idList[i]).prop('checked', true);
}
      $.each(filterlist, function(i, val){

                        $("input[value='" + val + "']").prop('checked', true);
                        });
  });
        
    }
   

    function show_hide_column(){
      
      $('.editable').popover('hide');
      filterlist = [];
      idList = [];
     
    
        $.each($("input[name='text']:checked"), function()
        {  
            if(idList.includes(this.id) !== true){
                idList.push(this.id)
            }
            if(filterlist.includes($(this).val()) !== true){
                filterlist.push($(this).val());
            }

                
});


console.log(filterlist);
console.log(idList);
var numbers = [1,2,3];
if (filterlist.length === 0){
for(i=0;i<19;i++){
    $('td:nth-child('+i+'),th:nth-child('+i+')').show();
}
}
        
else{
    for(i=4;i<=19;i++){
    $('td:nth-child('+i+'),th:nth-child('+i+')').hide();
}
filterlist.forEach(myFunction);
function myFunction(value, index, array) {
 $('td:nth-child('+value+'),th:nth-child('+value+')').show();
}
    
}

allignedrows();

  }

  function back_prev(){
      console.log('back');
      window.location.href = "/";
  }

  function allignedrows(){
    var match_count = [];
var ratingTdText;

$("tbody").find("tr:visible").each(function() { //get all rows in table
   
    $(this).find('td.color-green:visible').each(function(){ //find alligned cells and count the alligned cells
         
         ratingTdText = $(this).text();
         
         match_count.push(ratingTdText);
         
        
         if( match_count.length == filterlist.length){ // compare number of columns selected and alligned cell count
             
             $(this).closest('tr').addClass('cellRow'); 
             
            }
           
         
       
    }); 
   
    console.log(match_count.length);
     
     match_count =[];
    
});
var alligned =$('.cellRow').length;
notAlligned = count-alligned;
document.getElementById('totalCount1').innerHTML = alligned+" Urls";
document.getElementById('totalCount2').innerHTML = notAlligned+" Urls";

  }

     function download(){

        
        var html = document.querySelector("table").outerHTML;
	    export_table_to_csv(html, "meta-tag.csv");
      
     }

     function download_csv(csv, filename) {
    var csvFile;
    var downloadLink;

    // CSV FILE
    csvFile = new Blob([csv], {type: "text/csv"});

    // Download link
    downloadLink = document.createElement("a");

    // File name
    downloadLink.download = filename;

    // We have to create a link to the file
    downloadLink.href = window.URL.createObjectURL(csvFile);

    // Make sure that the link is not displayed
    downloadLink.style.display = "none";

    // Add the link to your DOM
    document.body.appendChild(downloadLink);

    // Lanzamos
    downloadLink.click();
}

function export_table_to_csv(html, filename) {
	var csv = [];
	var rows = document.querySelectorAll("table tr");
	
    for (var i = 0; i < rows.length; i++) {
		var row = [], cols = rows[i].querySelectorAll("td, th");
		
        for (var j = 0; j < cols.length; j++) 
            row.push('"' + cols[j].innerText + '"');
        
		csv.push(row.join(","));		
	}

    // Download CSV
    download_csv(csv.join("\n"), filename);
}




 
  
    

    window.onload = function() {

        $("h2 > .editable").popover({
    html: true,
    sanitize: false
});
       var p= $('#example').popover();
p.on("shown.bs.popover", function(e){
    p.data("bs.popover").tip().css({"max-width": "500px"});
});
  //$('.editable').on('shown.bs.popover', function() {
  //  $('input[type=checkbox').on('click', function() {
  //       $(this).prop('checked', $(this).prop('original'));
      
     
  //  });
//  });




    $(".editable").on("shown.bs.popover",function(){
        $(".popover-content input").on("change",function(){
            if(this.checked){
                this.setAttribute("checked","checked");
            }else{
                this.removeAttribute("checked");
            }
           // $(".container").html($(".popover-content").html());
        });
    });


     //const jsonfile = JSON.parse('{{jsonfile|tojson|safe}}');
     // const jsonnew= JSON.stringify(jsonfile);
      //console.log(jsonnew['output2']);
      //console.log(jsonfile);
      var jsonfile= {{jsonfile|tojson}};
            //console.log(jsd,typeof(jsd));
            //var output1 = JSON.parse(jsd['output']);
            //console.log(output1);
      const jsonString = JSON.parse(jsonfile['output2']);
      const jsonString1 = JSON.parse(jsonfile['output']);
      //console.log(jsonfile['col_list']);
      prefilter = jsonfile['col_list'];
      validation = jsonfile['validation'];
      page = jsonfile['page'];
      document.getElementById('validation').innerHTML=validation;
      document.getElementById('page').innerHTML=page;
       //filterlist = JSON.parse(filterlist);
       const jsonUrls1= JSON.parse(jsonString);
      const jsonUrls= JSON.parse(jsonString1);
      console.log(typeof(jsonUrls));
      console.log(typeof(jsonUrls1));
      console.log(jsonUrls);
      //console.log(filterlist);
      var refe=jsonUrls1[1];
      var tableurl= jsonUrls[0];
      console.log(refe['master_url']);
      //console.log(jsonUrls1[1]['master_url']);
      //console.log(typeof(jsonUrls1));
      //console.log(jsonfile.output2["url"]);
       count=Object.keys(jsonUrls).length;
      console.log(count);
    
      //document.body.innerHTML = jsonfile[0]['url'];
     
      var col = [];
        for (var i = 0; i < Object.keys(jsonUrls).length; i++) {
            for (var key in jsonUrls[i]) {
                if (col.indexOf(key) === -1) {
                    col.push(key);
                }
                
            }
        }

        // Create a table.
        var table = document.createElement("table");
        table.className = "myTable";
        // Create table header row using the extracted headers above.
        var tr = table.insertRow(-1);                   // table row.

        for (var i = 0; i < col.length; i++) {
            var th = document.createElement("th"); 
            th.className="tableHeader";     // table header.
            th.innerHTML = col[i];
            tr.appendChild(th);
        }

        // add json data to the table as rows.
        countf =0;
        
        //console.log(jsonUrls[14][col[4]],jsonUrls[14][col[4-1]]);
        for (var i = 0; i < Object.keys(jsonUrls).length; i++) {

            tr = table.insertRow(-1);
            
            for (var j = 0; j < col.length; j++) {
                var tabCell = tr.insertCell(-1);
                
                countf= countf+1;
               // if(i==0){
               //     tr.className = "cellfirst";
               // }
              
                //if(j==3){
                    //console.log(jsonUrls[i][col[4]],jsonUrls[i][col[4-1]]);
                  //  if(jsonUrls[i][col[3]] == 1 && jsonUrls[i][col[3-1]] == 1){
                    //    tr.className = "cellRow";
                       // alligned= alligned+1;
                    //}
                   
                //}
              if(i==0){
                tr.className = "cellRow";
              }

                if( j > 2 && i>=1){
                
                
                if(col[j]=="bu" && jsonUrls[i][col[j]]!=jsonUrls1[1]['bu']){
                   
                    
                    tabCell.className ="cellError";
                    tabCell.innerHTML = "<span class='color1-red'>"+jsonUrls[i][col[j]];+"</span>";
                }
            
                else if(col[j]=="web_section_id" && jsonUrls[i][col[j]]!=jsonUrls1[1]['web_section_id']){
                    tabCell.className ="cellError";
                    tabCell.innerHTML = jsonUrls[i][col[j]];
                    
                }
                else if(col[j]=="page_content" && jsonUrls[i][col[j]]!=jsonUrls1[1]['page_content']){
                    tabCell.className ="cellError";
                    tabCell.innerHTML = jsonUrls[i][col[j]];
                    
                }
                else if(col[j]=="segment" && jsonUrls[i][col[j]]!=jsonUrls1[1]['segment']){
                    tabCell.className ="cellError";
                    tabCell.innerHTML = jsonUrls[i][col[j]];
                    
                }
                else if(col[j]== "lifecycle" && jsonUrls[i][col[j]]!=jsonUrls1[1]['lifecycle']){
                    tabCell.className ="cellError";
                    tabCell.innerHTML = jsonUrls[i][col[j]];
                    
                }
                else if(col[j]=="user_profile" && jsonUrls[i][col[j]]!=jsonUrls1[1]['user_profile']){
                    tabCell.className ="cellError";
                    tabCell.innerHTML = jsonUrls[i][col[j]];
                    
                }
                 else if(col[j]=="simple_title" && jsonUrls[i][col[j]]!=jsonUrls1[1]['simple_title']){
                    tabCell.className ="cellError";
                    tabCell.innerHTML = jsonUrls[i][col[j]];
                    
                }
                else if(col[j]=="hp_design_Version" && jsonUrls[i][col[j]]!=jsonUrls1[1]['hp_design_version']){
                    tabCell.className ="cellError";
                    tabCell.innerHTML = jsonUrls[i][col[j]];
                    
                }
                 else if(col[j]=="page_level" && jsonUrls[i][col[j]]!=jsonUrls1[1]['page_level']){
                    tabCell.className ="cellError";
                    tabCell.innerHTML = jsonUrls[i][col[j]];
                    
                }
                 else if(col[j]=="product_type" && jsonUrls[i][col[j]]!=jsonUrls1[1]['product_type']){
                    tabCell.className ="cellError";
                    tabCell.innerHTML = jsonUrls[i][col[j]];
                    
                }
                 else if(col[j]=="family" && jsonUrls[i][col[j]]!=jsonUrls1[1]['family']){
                    tabCell.className ="cellError";
                    tabCell.innerHTML = jsonUrls[i][col[j]];
                    
                }
                else if(col[j]=="sub_bu" && jsonUrls[i][col[j]]!=""){
                    tabCell.className ="cellError";
                    tabCell.innerHTML = jsonUrls[i][col[j]];
                    
                }
                else if(col[j]=="analytics_template_name" && jsonUrls[i][col[j]]!=""){
                    tabCell.className ="cellError";
                    tabCell.innerHTML = jsonUrls[i][col[j]];
                    
                }
                else if(col[j]=="product_service_name" && jsonUrls[i][col[j]]!=""){
                    tabCell.className ="cellError";
                    tabCell.innerHTML = jsonUrls[i][col[j]];
                    
                }
                else if(col[j]=="analytics_section" && jsonUrls[i][col[j]]!=""){
                    tabCell.className ="cellError";
                    tabCell.innerHTML = jsonUrls[i][col[j]];
                    
                }
                else{
                    tabCell.className ="color-green";
                    tabCell.innerHTML ="<span>"+ jsonUrls[i][col[j]];+"</span>"
                }
                }
                else{
                    //tabCell.className ="cellError";
                    tabCell.innerHTML = "<span class='color1-red'>"+jsonUrls[i][col[j]];+"</span>";
                    
                }
                
                
            }
            countf =0;
        }

        // Now, add the newly created table with json data, to a container.
        var divShowData = document.getElementById('resultTable');
        divShowData.innerHTML = "";
        divShowData.appendChild(table);
        
        notAlligned = count-alligned;
        console.log(count);
        console.log(alligned);
          document.getElementById('totalCount').innerHTML = count+" Urls";
          document.getElementById('totalCount1').innerHTML = alligned+" Urls";
           document.getElementById('totalCount2').innerHTML = notAlligned+" Urls";
      document.getElementById('urlvalue').innerHTML = jsonUrls1[1]['master_url'];
      document.getElementById('buValue').innerHTML = jsonUrls1[1]['bu'];
      document.getElementById('webValue').innerHTML = jsonUrls1[1]['web_section_id'];
      document.getElementById('profileValue').innerHTML = jsonUrls1[1]['user_profile'];
      document.getElementById('simpleValue').innerHTML = jsonUrls1[1]['simple_title'];
     document.getElementById('segmentValue').innerHTML = jsonUrls1[1]['simple_title'];
      document.getElementById('contentValue').innerHTML = jsonUrls1[1]['page_content'];
       document.getElementById('segmentValue').innerHTML = jsonUrls1[1]['segment'];
        document.getElementById('lifeValue').innerHTML = jsonUrls1[1]['lifecycle'];
         document.getElementById('versionValue').innerHTML = jsonUrls1[1]['hp_design_version'];
    document.getElementById('nameValue').innerHTML = jsonUrls1[1]['analytics_template_name'];
    document.getElementById('subBuValue').innerHTML = jsonUrls1[1]['sub_bu'];
    document.getElementById('prodValue').innerHTML = jsonUrls1[1]['product_type'];
    document.getElementById('famValue').innerHTML = jsonUrls1[1]['family'];
    document.getElementById('analyticsValue').innerHTML = jsonUrls1[1]['analytics_section'];
    console.log(jsonUrls1[1]['product_service_name']);
     //document.getElementById('productValue').innerHTML= jsonUrls1[1]['product_service_name'];
      document.getElementById('plValue').innerHTML = jsonUrls1[1]['page_level'];
     if(jsonUrls1[1]['product_service_name']===""){
      document.getElementById('productValue').innerHTML = "-";
     }
      if(jsonUrls1[1]['analytics_section'] === "" ){
     document.getElementById('analyticsValue').innerHTML="-";
      }
    if(jsonUrls1[1]['analytics_template_name'] === "" ){
     document.getElementById('nameValue').innerHTML="-";
      }
      if(jsonUrls1[1]['sub_bu'] === "" ){
     document.getElementById('subBuValue').innerHTML="-";
      }
     // else{
     //document.getElementById('plValue').innerHTML = jsonUrls1[1]['page_level'];
     // }
     
        $('#resultTable').scroll(function(){
        var a = $("#resultTable").scrollTop();
        $(".resultTable").scrollTop(a);
    });
    
    //var prefilter1 = Object.keys(prefilter).map(item => prefilter[item]);
   
    show_filtered_column(prefilter);
    
    //const keys = Object.keys(prefilter);

// print all keys

   //console.log(prefilter);
   
   // for(i=4;i<=18;i++){
          // $('td:nth-child('+i+'),th:nth-child('+i+')').hide();
         //}
          
    
   // for (let key in prefilter) {
   //console.log(prefilter[key].trim());
   // prefilter[key]=prefilter[key].replace(/\s/g, "")
   // $('td:nth-child('+prefilter[key]+'),th:nth-child('+prefilter[key]+')').show();
      //  console.log(typeof(prefilter[key]));
        
    
//}

     } 

     function show_filtered_column(prefilter){
        for(i=4;i<=18;i++){
           $('td:nth-child('+i+'),th:nth-child('+i+')').hide();
         }
          
    
    for (let key in prefilter) {
   //console.log(prefilter[key].trim());
    prefilter[key]=prefilter[key].replace(/\s/g, "")
    $('td:nth-child('+prefilter[key]+'),th:nth-child('+prefilter[key]+')').show();
        console.log(typeof(prefilter[key]));
        filterlist.push(prefilter[key]);
    
        }
        
        
        allignedrows();
   }





    </script>
   
    
    </body>
<html>
